### （section07）テーブルの外部キーの作成

テーブルに外部キーを追加するための設定を行います。  
まずは、テーブルを開きます。  

![](../image/10_Table_01.png)

カラムを追加します。  
ここではすでに存在しているカラムを再利用します。  

![](../image/10_Table_02_ColumnName.png)

カラムが末尾に追加された状態になりました。  

![](../image/10_Table_03.png)

「foreign key」のタブを開きます。

![](../image/10_Table_04.png)

「Columns」「Reference table」「Reference columns」のセルのいずれかをダブルクリックします。

上段が参照元テーブルの情報で、下段が参照先テーブルの情報となります。  
ここからebonyrackの独自仕様があります。  
そもそも、MySQLの仕様としては、外部キーの1番目のカラムには、キー（インデックス）が必須となります。  
ただし、キーがない場合、自動的にMySQLが作成します。  
とはいえ、外部キーは実際には使わず、リレーションの可視化のみに使いたいケースもあります。  
そのような場合に、明示的にキー（インデックス）を設定しないと、  
実際にJOINする場合にパフォーマンスが悪くなるなどの事象もあります。  
そのため、ebonyrackでは、事前にキー（主キー、ユニークキー、インデックス）の1番目があるカラムにしか、  
外部キーの1番目として設定できないようにしています。  
そのため、「Seq in index」で1が指定できるのは、「First key」に記載があるカラムだけとなります。  

![](../image/10_Table_05_ForeignKey.png)

一旦戻って、キー（インデックス）を設定します。  

![](../image/10_Table_06.png)

再度、外部キー設定のため、「foreign key」のタブから、外部キー設定を行います。

![](../image/10_Table_07_ForeignKey.png)

![](../image/10_Table_08_ForeignKey.png)

また、ここでもebonyrackの独自仕様として、  
「Column type」が同一のものしか、外部キーとして設定できない、としています。  
MySQLでは、参照先のカラム型が参照元のカラム型を包括していればよいという仕様ですが、  
わかりにくいため、シンプルに同一型のみを許可する形をとっています。  

![](../image/10_Table_09.png)

 __Save and close__ を押下すると、  
テーブルの情報がワークスペース上に表示されます。  
ここでは、外部キーの情報を使って、2つのテーブルが結線されています。  

![](../image/11_Main_01.png)

また、外部キーの線を押下することで、関係を持ったカラムが強調表示されます。  

![](../image/11_Main_02.png)

---

[（section08）DDL表示](section08.md)

[一覧に戻る](../manual.ja.md)